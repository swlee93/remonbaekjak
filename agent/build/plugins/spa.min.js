!function(){var o,n=!1,e=!1,u=!1,l=!1,s=!1,p=!0,O=!1,g=!1,d=!1,a=[],r=!1;BOOMR=window.BOOMR||{};BOOMR.plugins=BOOMR.plugins||{};if(!BOOMR.plugins.SPA&&BOOMR.plugins.AutoXHR){var f={spaHardMissedOnComplete:function(t){var e,n=BOOMR.plugins.RT&&BOOMR.plugins.RT.navigationStart();r=!1;BOOMR.addVar("spa.missed","1",!0);BOOMR.plugins.RT&&BOOMR.plugins.RT.clearTimer("t_done");t.timing.requestStart=n;0===t.resources.length&&(e=BOOMR.getPerformance())&&e.timing&&e.timing.navigationStart&&e.timing.loadEventEnd&&(t.timing.loadEventEnd=e.timing.loadEventEnd)},pageReady:function(){l=!0}};BOOMR.plugins.SPA={is_complete:function(){return!r},init:function(t){if(t&&t.instrument_xhr){s=t.instrument_xhr;u&&s&&BOOMR.plugins.AutoXHR.enableAutoXhr()}if(!e){e=!0;BOOMR.subscribe("page_ready",f.pageReady,null,f)}},register:function(t){a.push(t)},supported_frameworks:function(){return a},onLoadSpaHardMissed:function(){if(!u){l=!0;s&&BOOMR.plugins.AutoXHR.enableAutoXhr();r=!0;d?r=!1:BOOMR.plugins.SPA.route_change(f.spaHardMissedOnComplete)}},hook:function(t,e){e=e||{};R("Hooked");"function"==typeof e.routeFilter&&(O=e.routeFilter);"function"==typeof e.routeChangeWaitFilter&&(g=e.routeChangeWaitFilter);e.disableHardNav&&(d=e.disableHardNav);if(n)return this;t&&BOOMR.attach_page_ready(this.onLoadSpaHardMissed);n=!0;return this},route_change:function(e,t){R("Route Change");var n=!1,i=p&&!d?"spa_hard":"spa";if(o&&o.wait)R("Route change wait filter not complete; not tracking this route");else{if("spa"==i&&O)try{if(!O.apply(null,t)){R("Route filter returned false; not tracking this route");return}R("Route filter returned true; tracking this route")}catch(t){BOOMR.addError(t,"SPA.route_change.routeFilter")}u=!0;var a=BOOMR.plugins.RT&&BOOMR.plugins.RT.navigationStart(),r=l?BOOMR.now():a,a=BOOMR.window.document.URL;BOOMR.fireEvent("spa_init",[BOOMR.plugins.SPA.current_spa_nav(),a]);a={timing:{requestStart:r},initiator:i,url:a};p=!1;if(!l||"function"==typeof e){l=!0;a.onComplete=function(t){if(!n){n=!0;BOOMR.fireEvent("spa_navigation")}"function"==typeof e&&e(t)}}if("spa"==i&&g){R("Running route change wait filter");try{if(g.apply(null,arguments)){R("Route filter returned true; waiting for complete call");a.wait=!0;o=a}else R("Route wait filter returned false; not waiting for complete call")}catch(t){BOOMR.addError(t,"SPA.route_change.routeChangeWaitFilter")}}a.index=BOOMR.plugins.AutoXHR.getMutationHandler().addEvent(a);s&&BOOMR.plugins.AutoXHR.enableAutoXhr()}},last_location:function(t){lastLocationChange=t},current_spa_nav:function(){return l?"spa":"spa_hard"},wait_complete:function(){R("Route change wait filter completed");if(o){o.wait=!1;if(o.waitComplete){R("Route wait filter complete");o.waitComplete()}o=null}},markNavigationComplete:function(){var t,e,n=BOOMR.plugins.AutoXHR.getMutationHandler();o&&o.wait&&BOOMR.plugins.SPA.wait_complete();if(n&&0<n.pending_events.length)for(t=n.pending_events.length-1;0<=t;t--)if((e=n.pending_events[t])&&BOOMR.utils.inArray(e.type,BOOMR.constants.BEACON_TYPE_SPAS)){if(e.complete)break;R("SPA Navigation being marked complete; nodes waiting for: "+n.nodesWaitingFor(t));BOOMR.addVar("spa.forced","1",!0);BOOMR.addVar("spa.waiting",n.nodesWaitingFor(),!0);n.completeEvent(t);return}R("No SPA navigation in progress to mark as complete")},isSpaNavInProgress:function(){var t,e,n=BOOMR.plugins.AutoXHR.getMutationHandler();if(n&&0<n.pending_events.length)for(t=n.pending_events.length-1;0<=t;t--)if((e=n.pending_events[t])&&BOOMR.utils.inArray(e.type,BOOMR.constants.BEACON_TYPE_SPAS))return!e.complete;return!1},isSinglePageApp:function(t){var e=!1,n=this.supported_frameworks();for(i=0;i<n.length;i++){var a=n[i];if(t[a]&&t[a].enabled){e=!0;break}}return e}};BOOMR.plugins.SPA.waitComplete=BOOMR.plugins.SPA.wait_complete}function R(t){BOOMR.debug(t,"SPA")}}();
//# sourceMappingURL=spa.min.js.map