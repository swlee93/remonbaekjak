!function(i){var r,s,o=1800;BOOMR=window.BOOMR||{};BOOMR.plugins=BOOMR.plugins||{};if(!BOOMR.plugins.RT){s={onloadfired:!1,unloadfired:!1,visiblefired:!1,initialized:!1,complete:!1,autorun:!0,timers:{},cookie:"RT",cookie_exp:604800,session_exp:o,strict_referrer:!0,navigationType:0,navigationStart:void 0,responseStart:void 0,loadTime:0,oboError:0,t_start:void 0,cached_t_start:void 0,cached_xhr_start:void 0,t_fb_approx:void 0,r:void 0,beacon_url:void 0,next_beacon_url:void 0,basic_timers:{t_done:1,t_resp:1,t_page:1},crossdomain_sending:!1,navigationStartSource:"",updateCookie:function(t,e){var i,r,n;if(!this.cookie)return!1;for(n in r=BOOMR.utils.getSubCookies(BOOMR.utils.getCookie(this.cookie))||{})r.hasOwnProperty(n)&&(isNaN(parseInt(n,10))||delete r[n]);if("object"==typeof t)for(n in t)t.hasOwnProperty(n)&&(void 0===t[n]?r.hasOwnProperty(n)&&delete r[n]:r[n]=t[n]);r.z=1;r.dm=BOOMR.session.domain;r.si=BOOMR.session.ID;r.ss=BOOMR.session.start.toString(36);r.sl=BOOMR.session.length.toString(36);s.session_exp!==o&&(r.se=s.session_exp.toString(36));BOOMR.session.rate_limited&&(r.rl=1);r.tt=this.loadTime.toString(36);0<this.oboError?r.obo=this.oboError.toString(36):delete r.obo;i=BOOMR.now();if(e){r[e]=(i-BOOMR.session.start).toString(36);s.lastActionTime=i}this.beacon_url&&(r.bcn=this.beacon_url);BOOMR.debug("Setting cookie (timer="+e+")\n"+BOOMR.utils.objectToString(r),"rt");if(!BOOMR.utils.setCookie(this.cookie,r,this.cookie_exp)){BOOMR.error("cannot set start cookie","rt");return!1}if(50<(e=BOOMR.now())-i){BOOMR.utils.removeCookie(this.cookie);BOOMR.error("took more than 50ms to set cookie... aborting: "+i+" -> "+e,"rt")}return!0},refreshSession:function(t){if(t=t||BOOMR.plugins.RT.getCookie()){t.ss?BOOMR.session.start=t.ss:BOOMR.session.start=BOOMR.plugins.RT.navigationStart()||BOOMR.t_lstart||BOOMR.t_start;t.si&&t.si.match(/-/)&&(BOOMR.session.ID=t.si);t.sl&&(BOOMR.session.length=t.sl);t.tt&&(this.loadTime=t.tt);t.obo&&(this.oboError=t.obo);t.dm&&!BOOMR.session.domain&&(BOOMR.session.domain=t.dm);t.se&&(s.session_exp=t.se);t.bcn&&(this.beacon_url=t.bcn);t.rl&&"1"===t.rl&&(BOOMR.session.rate_limited=!0)}},maybeResetSession:function(t,e){BOOMR.debug("Current session meta:\n"+BOOMR.utils.objectToString(BOOMR.session),"rt");BOOMR.debug("Timers: t_start="+e+", sessionLoad="+s.loadTime+", sessionError="+s.oboError+", lastAction="+s.lastActionTime,"rt");var i=0;BOOMR.session.start&&BOOMR.session.length&&(i=(BOOMR.now()-BOOMR.session.start)/BOOMR.session.length);var r=1e3*s.session_exp;if(!BOOMR.session.start||e&&BOOMR.session.start>e||t-(s.lastActionTime||BOOMR.t_start)>r||r<i){BOOMR.session.start=e||BOOMR.plugins.RT.navigationStart()||BOOMR.t_lstart||BOOMR.t_start;BOOMR.session.length=0;BOOMR.session.rate_limited=!1;s.loadTime=0;s.oboError=0;s.beacon_url=s.next_beacon_url;s.lastActionTime=t;s.updateCookie({rl:void 0,sl:BOOMR.session.length,ss:BOOMR.session.start,tt:s.loadTime,obo:void 0,bcn:s.beacon_url})}BOOMR.debug("New session meta:\n"+BOOMR.utils.objectToString(BOOMR.session),"rt");BOOMR.debug("Timers: t_start="+e+", sessionLoad="+s.loadTime+", sessionError="+s.oboError,"rt")},initFromCookie:function(){var t,e,i=BOOMR.plugins.RT.getCookie();this.cookie||(BOOMR.session.enabled=!1);if(i){i.s=Math.max(+i.ld||0,Math.max(+i.ul||0,+i.cl||0));BOOMR.debug("Read from cookie "+BOOMR.utils.objectToString(i),"rt");if(i.s&&(i.r||i.nu)){this.r=i.r;t=BOOMR.utils.hashString(r.URL);e=BOOMR.utils.hashString(r&&r.referrer||"");BOOMR.debug("referrer check: "+this.r+" =?= "+e,"rt");i.cl&&BOOMR.debug(i.s+" <? "+(+i.cl+15),"rt");i.nu&&BOOMR.debug(i.nu+" =?= "+t,"rt");if(!this.strict_referrer||i.cl&&i.nu&&i.nu===t&&i.s<+i.cl+15||i.s===+i.ul&&this.r===e){this.t_start=i.s;+i.hd>i.s&&(this.t_fb_approx=i.hd)}else this.t_start=this.t_fb_approx=void 0}i.s&&(this.lastActionTime=i.s);this.refreshSession(i);this.updateCookie({s:void 0,ul:void 0,cl:void 0,hd:void 0,ld:void 0,rl:void 0,r:void 0,nu:void 0,sh:void 0});this.maybeResetSession(BOOMR.now())}},incrementSessionDetails:function(){BOOMR.debug("Incrementing Session Details... ","RT");BOOMR.session.length++;!s.timers.t_done||isNaN(s.timers.t_done.delta)?s.oboError++:s.loadTime+=s.timers.t_done.delta},getBoomerangTimings:function(){var t,e,i,r,n;function o(t,e){t=Math.round(t||0),e=Math.round(e||0);return(t=0===t?0:t-e)||""}if(BOOMR.t_start){BOOMR.plugins.RT.startTimer("boomerang",BOOMR.t_start);BOOMR.plugins.RT.endTimer("boomerang",BOOMR.t_end);BOOMR.plugins.RT.endTimer("boomr_fb",BOOMR.t_start);if(BOOMR.t_lstart){BOOMR.plugins.RT.endTimer("boomr_ld",BOOMR.t_lstart);BOOMR.plugins.RT.setTimer("boomr_lat",BOOMR.t_start-BOOMR.t_lstart)}}try{if(window&&"performance"in window&&window.performance&&"function"==typeof window.performance.getEntriesByName){e={"rt.bmr":BOOMR.url};BOOMR.config_url&&(e["rt.cnf"]=BOOMR.config_url);for(i in e)if(e.hasOwnProperty(i)&&e[i]&&(t=window.performance.getEntriesByName(e[i]))&&0!==t.length&&t[0]){n=[r=o((t=t[0]).startTime,0),o(t.responseEnd,r),o(t.responseStart,r),o(t.requestStart,r),o(t.connectEnd,r),o(t.secureConnectionStart,r),o(t.connectStart,r),o(t.domainLookupEnd,r),o(t.domainLookupStart,r),o(t.redirectEnd,r),o(t.redirectStart,r)].join(",").replace(/,+$/,"");BOOMR.addVar(i,n,!0)}}}catch(t){t&&t.name&&t.name.hasOwnProperty("length")&&-1===t.name.indexOf("NS_ERROR_FAILURE")&&BOOMR.addError(t,"rt.getBoomerangTimings")}},checkPreRender:function(){if("prerender"!==BOOMR.visibilityState())return!1;BOOMR.plugins.RT.startTimer("t_load",this.navigationStart);BOOMR.plugins.RT.endTimer("t_load");BOOMR.plugins.RT.startTimer("t_prerender",this.navigationStart);BOOMR.plugins.RT.startTimer("t_postrender");return!0},initFromNavTiming:function(){var t,e;if(!this.navigationStart){(e=BOOMR.getPerformance())&&e.navigation&&(this.navigationType=e.navigation.type);if(e&&e.timing){t=e.timing;this.navigationStartSource="navigation"}else if(i.chrome&&i.chrome.csi&&i.chrome.csi().startE){t={navigationStart:i.chrome.csi().startE};this.navigationStartSource="csi"}else if(i.gtbExternal&&i.gtbExternal.startE()){t={navigationStart:i.gtbExternal.startE()};this.navigationStartSource="gtb"}if(t){this.navigationStart=t.navigationStart||t.fetchStart||void 0;this.fetchStart=t.fetchStart||void 0;this.responseStart=t.responseStart||void 0;navigator.userAgent.match(/Firefox\/[78]\./)&&(this.navigationStart=t.unloadEventStart||t.fetchStart||void 0)}else BOOMR.warn("This browser doesn't support the WebTiming API","rt")}},validateLoadTimestamp:function(t,e,i){return e&&e.timing&&e.timing.loadEventEnd?e.timing.loadEventEnd:"xhr"!==i||e&&BOOMR.utils.inArray(e.initiator,BOOMR.constants.BEACON_TYPE_SPAS)?(e=BOOMR.getPerformance())&&e.timing?e.timing.loadEventEnd||t:BOOMR.t_onload||BOOMR.t_lstart||BOOMR.t_start||t:t},setPageLoadTimers:function(t,e,i){var r,n;if(!("xhr"===t||"early"===t&&i&&BOOMR.utils.inArray(i.initiator,BOOMR.constants.BEACON_TYPE_SPAS))){s.initFromCookie();s.initFromNavTiming();BOOMR.addVar("rt.start",this.navigationStartSource);if(s.checkPreRender())return!1}if("xhr"===t)if(i.timers)for(var o in i.timers)i.timers.hasOwnProperty(o)&&BOOMR.plugins.RT.setTimer(o,i.timers[o]);else i&&i.timing&&(void 0===(n=i.timing.fetchStart)||i.timing.responseEnd>=n)&&(r=i.timing.responseEnd);else s.responseStart?s.responseStart>=s.navigationStart&&s.responseStart>=s.fetchStart&&(r=s.responseStart):s.timers.hasOwnProperty("t_page")?BOOMR.plugins.RT.endTimer("t_page"):s.t_fb_approx&&(r=s.t_fb_approx);if(r&&"early"!==t){n?BOOMR.plugins.RT.setTimer("t_resp",n,r):BOOMR.plugins.RT.endTimer("t_resp",r);"load"===t&&s.timers.t_load?BOOMR.plugins.RT.setTimer("t_page",s.timers.t_load.end-r):e<r?BOOMR.addVar("t_page.inv",1,!0):BOOMR.plugins.RT.setTimer("t_page",e-r)}if("load"===t&&s.timers.hasOwnProperty("t_postrender")){BOOMR.plugins.RT.endTimer("t_postrender");BOOMR.plugins.RT.endTimer("t_prerender")}return!0},setSupportingTimestamps:function(t,e){t&&BOOMR.addVar("rt.tstart",t,!0);"number"==typeof s.navigationStart&&s.navigationStart!==t&&BOOMR.addVar("rt.nstart",s.navigationStart,!0);"number"==typeof s.t_start&&s.t_start!==t&&BOOMR.addVar("rt.cstart",s.t_start,!0);BOOMR.addVar("rt.bstart",BOOMR.t_start,!0);BOOMR.t_lstart&&BOOMR.addVar("rt.blstart",BOOMR.t_lstart,!0);"early"===e?BOOMR.addVar("rt.end",t||BOOMR.now(),!0):s.timers.t_done&&BOOMR.addVar("rt.end",s.timers.t_done.end,!0)},determineTStart:function(t,e){var i;if("xhr"===t||"early"===t&&e&&"spa"===e.initiator){e&&e.name&&s.timers[e.name]?i=s.timers[e.name].start:e&&e.timing&&e.timing.requestStart&&(i=e.timing.requestStart);void 0===i&&e&&BOOMR.utils.inArray(e.initiator,BOOMR.constants.BEACON_TYPE_SPAS)?BOOMR.addVar("rt.start","none"):BOOMR.addVar("rt.start","manual");s.cached_xhr_start=i}else{if(s.navigationStart)i=s.navigationStart;else if(s.t_start&&2!==s.navigationType){i=s.t_start;BOOMR.addVar("rt.start","cookie")}else if(s.cached_t_start)i=s.cached_t_start;else{BOOMR.addVar("rt.start","none");i=void 0}s.cached_t_start=i}BOOMR.debug("Got start time: "+i,"rt");return i},page_ready:function(){this.onloadfired=!0},check_visibility:function(){"visible"===BOOMR.visibilityState()&&(s.visiblefired=!0)},prerenderToVisible:function(){if(s.onloadfired&&s.autorun){BOOMR.debug("Transitioned from prerender to "+BOOMR.visibilityState(),"rt");BOOMR.addVar("vis.pre","1",!0);BOOMR.plugins.RT.done(null,"visible")}},page_unload:function(t){BOOMR.debug("Unload called when unloadfired = "+this.unloadfired,"rt");this.unloadfired||BOOMR.plugins.RT.done(t,"unload");this.updateCookie(!s.navigationStart&&s.strict_referrer?{r:BOOMR.utils.hashString(r.URL)}:null,"beforeunload"===t.type?"ul":"hd");this.unloadfired=!0},_iterable_click:function(t,e,i,r){if(i){BOOMR.debug(t+" called with "+i.nodeName,"rt");for(;i&&i.nodeName&&i.nodeName.toUpperCase()!==e;)i=i.parentNode;if(i&&i.nodeName&&i.nodeName.toUpperCase()===e){BOOMR.debug("passing through","rt");this.refreshSession();this.maybeResetSession(BOOMR.now());r=r(i);this.updateCookie({nu:BOOMR.utils.hashString(r)},"cl");BOOMR.addVar("nu",BOOMR.utils.cleanupURL(r),!0)}}},onclick:function(t){s._iterable_click("Click","A",t,function(t){return t.href})},markComplete:function(){this.onloadfired&&(s.complete=!0)},onsubmit:function(t){s._iterable_click("Submit","FORM",t,function(t){t="function"==typeof t.getAttribute&&t.getAttribute("action")||r.URL||"";return t.match(/\?/)?t:t+"?"})},onconfig:function(t){t.beacon_url&&(s.beacon_url=t.beacon_url);if(t.RT){t.RT.oboError&&!isNaN(t.RT.oboError)&&t.RT.oboError>s.oboError&&(s.oboError=t.RT.oboError);if(t.RT.loadTime&&!isNaN(t.RT.loadTime)&&t.RT.loadTime>s.loadTime){s.loadTime=t.RT.loadTime;s.timers.t_done&&!isNaN(s.timers.t_done.delta)&&(s.loadTime+=s.timers.t_done.delta)}}},domloaded:function(){BOOMR.plugins.RT&&BOOMR.plugins.RT.endTimer("t_domloaded")},clear:function(t){t&&void 0!==t.early||BOOMR.removeVar("rt.start")},spaNavigation:function(){s.onloadfired=!0}};BOOMR.plugins.RT={init:function(t){BOOMR.debug("init RT","rt");i!==BOOMR.window&&(i=BOOMR.window);t&&t.CrossDomain&&t.CrossDomain.sending&&(s.crossdomain_sending=!0);if(i&&i.document){r=i.document;BOOMR.utils.pluginConfig(s,t,"RT",["cookie","cookie_exp","session_exp","strict_referrer"]);t&&void 0!==t.autorun&&(s.autorun=t.autorun);if(t&&t.beacon_url){s.beacon_url&&!t.force_beacon_url||(s.beacon_url=t.beacon_url);s.next_beacon_url=t.beacon_url}void 0!==r&&(s.r=BOOMR.utils.hashQueryString(r.referrer,!0));s.initFromCookie();if(s.initialized)return this;s.complete=!1;s.timers={};s.check_visibility();BOOMR.subscribe("page_ready",s.page_ready,null,s);BOOMR.subscribe("visibility_changed",s.check_visibility,null,s);BOOMR.subscribe("prerender_to_visible",s.prerenderToVisible,null,s);BOOMR.subscribe("page_ready",this.done,"load",this);BOOMR.subscribe("xhr_load",this.done,"xhr",this);BOOMR.subscribe("before_early_beacon",this.done,"early",this);BOOMR.subscribe("dom_loaded",s.domloaded,null,s);BOOMR.subscribe("page_unload",s.page_unload,null,s);BOOMR.subscribe("click",s.onclick,null,s);BOOMR.subscribe("form_submit",s.onsubmit,null,s);BOOMR.subscribe("before_beacon",this.addTimersToBeacon,"beacon",this);BOOMR.subscribe("beacon",s.clear,null,s);BOOMR.subscribe("error",s.markComplete,null,s);BOOMR.subscribe("config",s.onconfig,null,s);BOOMR.subscribe("spa_navigation",s.spaNavigation,null,s);BOOMR.subscribe("interaction",s.markComplete,null,s);BOOMR.getBeaconURL=function(){return s.beacon_url};s.initialized=!0;return this}},startTimer:function(t,e){if(t){"t_page"===t&&this.endTimer("t_resp",e);s.timers[t]={start:"number"==typeof e?e:BOOMR.now()}}return this},endTimer:function(t,e){if(t){s.timers[t]=s.timers[t]||{};void 0===s.timers[t].end&&(s.timers[t].end="number"==typeof e?e:BOOMR.now())}return this},clearTimer:function(t){t&&delete s.timers[t];return this},setTimer:function(t,e,i){t&&(s.timers[t]=void 0!==i?{start:e,end:i,delta:i-e}:{delta:e});return this},addTimersToBeacon:function(t,e){var i,r,n=[];for(i in s.timers)if(s.timers.hasOwnProperty(i)){if("number"!=typeof(r=s.timers[i]).delta){"number"!=typeof r.start&&(r.start="xhr"===e?s.cached_xhr_start:s.cached_t_start);r.delta=r.end-r.start}isNaN(r.delta)||(s.basic_timers.hasOwnProperty(i)?BOOMR.addVar(i,r.delta,!0):n.push(i+"|"+r.delta))}n.length&&BOOMR.addVar("t_other",n.join(","),!0);if("beacon"===e&&(!t||void 0===t.early)){s.timers={};s.complete=!1}},done:function(t,e){BOOMR.debug("Called done: "+e,"rt");if(BOOMR.plugins.RT){var i,r=BOOMR.now(),n=!1;s.complete=!1;i=s.validateLoadTimestamp(r,t,e);if(("load"===e||"visible"===e||"xhr"===e||"early"===e)&&!s.setPageLoadTimers(e,i,t))return this;("load"===e||"visible"===e||"early"===e&&(!t||void 0===t.initiator||"spa_hard"===t.initiator)||"xhr"===e&&t&&"spa_hard"===t.initiator)&&s.getBoomerangTimings();r=s.determineTStart(e,t);s.refreshSession();s.maybeResetSession(i,r);"early"!==e&&this.endTimer("t_done",i);t&&"xhr"===t.initiator&&this.setTimer("t_done",t.timing.requestStart,t.timing.loadEventEnd);s.setSupportingTimestamps(r,e);this.addTimersToBeacon(null,e);BOOMR.setReferrer(s.r);"xhr"===e&&t&&t&&t.data&&(t=t.data);if("xhr"===e&&t){n=t.subresource;t.url&&BOOMR.addVar("u",BOOMR.utils.cleanupURL(t.url.replace(/#.*/,"")),!0);t.status&&(t.status<-1||400<=t.status)&&BOOMR.addVar("http.errno",t.status,!0);t.method&&"GET"!==t.method&&BOOMR.addVar("http.method",t.method,!0);t.type&&"xhr"!==t.type&&BOOMR.addVar("http.type",t.type[0],!0);t.headers&&BOOMR.addVar("http.hdr",t.headers,!0);t.synchronous&&BOOMR.addVar("xhr.sync",1,!0);t.initiator&&BOOMR.addVar("http.initiator",t.initiator,!0);t.responseBodyNotUsed&&BOOMR.addVar("fetch.bnu",1,!0);t.responseUrl&&BOOMR.addVar("xhr.ru",BOOMR.utils.cleanupURL(t.responseUrl),!0)}n&&"passive"!==n&&BOOMR.addVar("rt.subres",1,!0);if("load"===e||"visible"===e||"xhr"===e&&!n||"unload"===e&&!s.onloadfired&&s.autorun&&!s.crossdomain_sending){s.incrementSessionDetails();s.updateCookie(null,"ld")}BOOMR.addVar({"rt.tt":s.loadTime,"rt.obo":s.oboError},void 0,!0);s.updateCookie();if("unload"===e){BOOMR.addVar("rt.quit","",!0);s.onloadfired||BOOMR.addVar("rt.abld","",!0);s.visiblefired||BOOMR.addVar("rt.ntvu","",!0)}"early"!==e&&(s.complete=!0);BOOMR.sendBeacon(s.beacon_url);return this}},is_complete:function(t){return s.complete||t&&"error"===t["http.initiator"]||t&&void 0!==t.early},updateCookie:function(){s.updateCookie()},getCookie:function(){var t,e,i;if(!s.cookie)return!1;if(t=BOOMR.utils.getSubCookies(BOOMR.utils.getCookie(s.cookie))||{}){if(1&t.z){e=36;i=parseInt(t.ss||0,36)}else{e=10;i=0}t.ss=parseInt(t.ss||0,e);t.tt=parseInt(t.tt||0,e);t.obo=parseInt(t.obo||0,e);t.sl=parseInt(t.sl||0,e);t.se&&(t.se=parseInt(t.se,e)||o);t.ld&&(t.ld=i+parseInt(t.ld,e));t.ul&&(t.ul=i+parseInt(t.ul,e));t.cl&&(t.cl=i+parseInt(t.cl,e));t.hd&&(t.hd=i+parseInt(t.hd,e))}return t},incrementSessionDetails:function(){s.incrementSessionDetails()},navigationStart:function(){s.navigationStart||s.initFromNavTiming();return s.navigationStart},resetTimings:function(){s.navigationStart=void 0;s.responseStart=void 0;s.loadTime=0;s.cached_t_start=void 0}}}}(window);
//# sourceMappingURL=rt.min.js.map