!function(){BOOMR=window.BOOMR||{};BOOMR.plugins=BOOMR.plugins||{};if(!BOOMR.plugins.IFrameDelay){var i=BOOMR.window,t={initialized:!1,registerParent:!1,monitoredCount:0,finishedCount:0,runningCount:0,runningFrames:{},loadingIntervalID:void 0,loadedIntervalID:void 0,loadEnd:0,messages:{start:"boomrIframeLoading",done:"boomrIframeLoaded",startACK:"boomrIframeLoadingACK",doneACK:"boomrIframeLoadedACK"},onIFrameMessageAsParent:function(e){var n;if(e&&e.data&&"string"==typeof e.data&&"{"===e.data.charAt(0)&&e.source){try{n=JSON.parse(e.data)}catch(e){return}if(n.msg===t.messages.start){o("Received start message from child IFrame");if(!t.runningFrames[n.pid]){e.source.postMessage(JSON.stringify({msg:t.messages.startACK}),e.origin);t.runningCount+=1;t.runningFrames[n.pid]=1}}else if(n.msg===t.messages.done){o("Received done message from child IFrame");e.source.postMessage(JSON.stringify({msg:t.messages.doneACK}),e.origin);--t.runningCount;t.finishedCount+=1;n.loadEnd>t.loadEnd&&(t.loadEnd=n.loadEnd);t.checkCompleteness()}}},onIFrameMessageAsChild:function(e){var n;if(e&&e.data&&"string"==typeof e.data&&"{"===e.data.charAt(0)&&e.source){try{n=JSON.parse(e.data)}catch(e){return}if(n.msg===t.messages.startACK){o("Received start message ACK from parent");clearInterval(t.loadingIntervalID);t.loadingIntervalID=void 0}else if(n.msg===t.messages.doneACK){o("Received done message ACK from parent");clearInterval(t.loadedIntervalID);t.loadedIntervalID=void 0}}},checkCompleteness:function(){if(t.is_complete()){BOOMR.addVar("ifdl.done",BOOMR.now());BOOMR.addVar("ifdl.ct",t.finishedCount);BOOMR.addVar("ifdl.r",t.runningCount);BOOMR.addVar("ifdl.mon",t.monitoredCount);BOOMR.hasBrowserOnloadFired()?BOOMR.page_ready(0<t.loadEnd?t.loadEnd:void 0):BOOMR.attach_page_ready(function(){BOOMR.page_ready(void 0,!0)})}},is_complete:function(){return!(t.enabled&&!t.registerParent)||t.finishedCount>=t.monitoredCount&&0===t.runningCount}};BOOMR.plugins.IFrameDelay={init:function(e){BOOMR.utils.pluginConfig(t,e,"IFrameDelay",["enabled","registerParent","monitoredCount"]);if(t.initialized)return this;t.initialized=!0;if(this.is_supported())if(t.registerParent){o("Running as Child. Found registerParent=true");BOOMR.utils.addListener(window,"message",t.onIFrameMessageAsChild);function n(){o("Trying to notify parent window of load start");i.parent.postMessage(JSON.stringify({msg:t.messages.start,pid:BOOMR.pageId}),"*")}n();t.loadingIntervalID=setInterval(n,250);BOOMR.subscribe("page_load_beacon",function(e){var n=e&&e["rt.end"]?e["rt.end"]:BOOMR.now();function a(){if(!t.loadingIntervalID){o("Trying to notify parent window of load end");i.parent.postMessage(JSON.stringify({msg:t.messages.done,pid:BOOMR.pageId,loadEnd:n}),"*")}}a();t.loadedIntervalID=setInterval(a,250)})}else if(!t.registerParent&&t.monitoredCount&&0<t.monitoredCount){o("Running as Parent. Found monitoredCount="+t.monitoredCount+", listening for messages from child windows");BOOMR.utils.addListener(i,"message",t.onIFrameMessageAsParent)}else{o("Missing configuration. Setting monitored, finished and running to 0 and closing this plugin");t.finishedCount=t.monitoredCount=t.runningCount=0;t.enabled=!1}else t.enabled=!1;return this},is_complete:function(){return t.is_complete()},is_supported:function(){return BOOMR.utils.hasPostMessageSupport()&&window.JSON}}}function o(e){BOOMR.debug("(url: "+i.location.href+"): "+e,"IFrameDelay")}}();
//# sourceMappingURL=iframe-delay.min.js.map